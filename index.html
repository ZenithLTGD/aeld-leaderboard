<!DOCTYPE html>
<html>
<head>
  <title>AELD Dashboard</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="nav">
  <a href="index.html" class="logo" style="display: flex; align-items: center; gap: 10px; text-decoration: none;">
    <img src="logo.png" alt="AELD Logo" style="height: 40px; width: auto;">
    <span style="color: white; font-weight: bold;">AELD</span>
  </a>
  <a href="index.html">Dashboard</a>
  <a href="levels.html">Levels</a>
  <a href="players.html">Top Players</a>
  <a href="submit.html">Submit Record</a>
</div>

<div class="container">
  <h2>Dashboard</h2>

  <div class="grid" id="statsGrid">
    <!-- Basic stats cards will be filled here -->
  </div>

  <div style="margin-top: 40px;">
    <h3>Latest Approved</h3>
    <div id="latestApproved" class="card" style="padding: 20px;"></div>
  </div>

  <div style="margin-top: 40px;">
    <h3>Hardest Level</h3>
    <div id="hardestLevel" class="card" style="padding: 20px;"></div>
  </div>

  <!-- What is AELD? explanation -->
  <div style="margin-top: 40px;">
    <h3>What is AELD?</h3>
    <div class="card" style="padding: 20px;">
      <p style="color: #9cc7d8; line-height: 1.6; margin: 0;">
        AELD stands for <strong>All Easy Leaderboard Demons</strong>.<br><br>
        Meaning, if you take a list demon like Acheron, put "Easy" at the end — you get <strong>Acheron Easy</strong>, which is a heavily nerfed version of the real Acheron. This applies to every level: <strong>Bloodbath Easy</strong>, <strong>Thinking Space II Easy</strong>, etc.<br><br>
        So, this is just list demons but in their <strong>easy version</strong>. Hopefully you now know what AELD is!
      </p>
    </div>
  </div>
</div>

<!-- Small footer credit at the very bottom -->
<div style="text-align: center; color: #7fb3c8; font-size: 13px; margin: 60px 0 40px;">
  Created by Beytaray, also known as ZenithLTGD.
</div>

<script>
  // Load Firebase compat libraries
  const loadFirebase = function() {
    const appScript = document.createElement('script');
    appScript.src = "https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js";
    appScript.onload = function() {
      const firestoreScript = document.createElement('script');
      firestoreScript.src = "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js";
      firestoreScript.onload = function() {
        const firebaseConfig = {
          apiKey: "AIzaSyBYwgt-Aq-ZJrgSuOphrJryMxtro",
          authDomain: "aeld-b5856.firebaseapp.com",
          projectId: "aeld-b5856",
          storageBucket: "aeld-b5856.appspot.com",
          messagingSenderId: "372163813001",
          appId: "1:372163813001:web:9ed8679669963063c8f058",
          measurementId: "G-3DMJ6NMZNZ"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        async function updateDashboard() {
          const statsGrid = document.getElementById("statsGrid");
          const latestDiv = document.getElementById("latestApproved");
          const hardestDiv = document.getElementById("hardestLevel");

          statsGrid.innerHTML = '<p style="grid-column: 1 / -1; text-align:center; color:#7fb3c8; padding:40px;">Loading dashboard...</p>';
          latestDiv.innerHTML = '<p style="text-align:center; color:#7fb3c8;">Loading...</p>';
          hardestDiv.innerHTML = '<p style="text-align:center; color:#7fb3c8;">Loading...</p>';

          try {
            const snapshot = await db.collection("submissions")
              .where("status", "==", "approved")
              .get();

            if (snapshot.empty) {
              statsGrid.innerHTML = `
                <div style="grid-column: 1 / -1; text-align:center; padding:40px; color:#7fb3c8;">
                  No approved records yet.<br><br>
                  <strong>Be the first to submit a record!</strong>
                </div>
              `;
              latestDiv.innerHTML = '';
              hardestDiv.innerHTML = '';
              return;
            }

            let totalLevels = snapshot.size;
            let uniquePlayers = new Set();
            let latest = null;
            let hardest = null;

            snapshot.forEach(doc => {
              const data = doc.data();
              if (data.player) uniquePlayers.add(data.player.trim());

              // Latest: most recent (using submittedAt or time)
              const timestamp = data.submittedAt || data.time || 0;
              if (!latest || timestamp > latest.timestamp) {
                latest = { ...data, timestamp };
              }

              // Hardest: lowest rank
              if (data.rank && (!hardest || data.rank < hardest.rank)) {
                hardest = data;
              }
            });

            const totalVictors = uniquePlayers.size;

            // Difficulty logic
            let difficulty = "Easy";
            if (totalLevels > 10) difficulty = "Extreme";
            else if (totalLevels > 5) difficulty = "Hard";
            else if (totalLevels > 0) difficulty = "Medium";

            // Stats cards
            statsGrid.innerHTML = `
              <div class="card">
                <div class="card-title">TOTAL LEVELS</div>
                <div class="big">${totalLevels}</div>
              </div>
              <div class="card">
                <div class="card-title">TOTAL VICTORS</div>
                <div class="big">${totalVictors}</div>
              </div>
              <div class="card">
                <div class="card-title">DIFFICULTY</div>
                <div class="big">${difficulty}</div>
              </div>
            `;

            // Latest approved
            if (latest) {
              const timeAgo = latest.timestamp ? new Date(latest.timestamp).toLocaleString() : "Unknown";
              latestDiv.innerHTML = `
                <div>
                  <strong>${latest.level || "Unnamed"}</strong> by ${latest.player || "Unknown"}<br>
                  <small style="color:#7fb3c8;">Progress: ${latest.completion || "?"}% • Approved ${timeAgo}</small>
                </div>
                <a href="${latest.proof || '#'}" target="_blank" style="color:#35e0ff; margin-top:8px; display:inline-block;">
                  View Proof ↗
                </a>
              `;
            } else {
              latestDiv.innerHTML = '<p style="text-align:center; color:#7fb3c8;">No recent approvals.</p>';
            }

            // Hardest level (rank 1)
            if (hardest && hardest.rank === 1) {
              hardestDiv.innerHTML = `
                <div>
                  <strong>#1 - ${hardest.level || "Unnamed"}</strong> by ${hardest.player || "Unknown"}<br>
                  <small style="color:#7fb3c8;">Progress: ${hardest.completion || "?"}%</small>
                </div>
                <a href="level-details.html?level=${encodeURIComponent(hardest.level || "Unnamed")}" style="color:#35e0ff; margin-top:8px; display:inline-block;">
                  View Victors ↗
                </a>
              `;
            } else {
              hardestDiv.innerHTML = '<p style="text-align:center; color:#7fb3c8;">No rank 1 level yet.</p>';
            }
          } catch (err) {
            console.error("Dashboard error:", err);
            statsGrid.innerHTML = `
              <div style="grid-column: 1 / -1; color:#ff6b6b; text-align:center; padding:20px;">
                Error loading dashboard: ${err.message}. Check console (F12).
              </div>
            `;
          }
        }

        updateDashboard();
      };
      document.head.appendChild(firestoreScript);
    };
    document.head.appendChild(appScript);
  };

  loadFirebase();
</script>

</body>
</html>